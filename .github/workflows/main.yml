permissions:
  contents: write
name: Auto Update Live TV Source

on:
  schedule:
    - cron: '0 22 * * *'  # UTC 22:00 = 北京时间06:00
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-file:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      with:
        # 不需要特殊配置，使用默认权限
        
    - name: Download TV source file
      run: |
        mkdir -p sej95.github.io
        cd sej95.github.io
        
        # 下载文件
        curl -s -L -o pllive.txt \
             -H "User-Agent: Mozilla/5.0" \
             "https://my9.ltd/tv/pllive.txt"
        
        echo "下载完成"
        ls -la pllive.txt
        
    - name: Commit changes
      run: |
        git config user.name "github-actions"
        git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
        
        # 检查是否有变化
        if git diff --no-ext-diff --quiet --exit-code sej95.github.io/pllive.txt; then
          echo "没有变化"
        else
          echo "有变化，提交更新"
          git add sej95.github.io/pllive.txt
          git commit -m "auto update: $(date '+%Y-%m-%d %H:%M:%S')"
          git push
        fi
